# micro-intra

**micro-infra** per microservizi NestJS: base di sviluppo in locale su Windows.

## üìÅ Struttura del progetto

micro-intra/
‚îú‚îÄ‚îÄ services/ # Cartella per i tuoi microservizi NestJS
‚îú‚îÄ‚îÄ infrastructure/ # Configurazioni di Redis, RabbitMQ, Kong, Konga, ecc.
‚îú‚îÄ‚îÄ scripts/
‚îÇ ‚îú‚îÄ‚îÄ powershell/ # Script PowerShell per gestire l‚Äôinfrastruttura
‚îÇ ‚îî‚îÄ‚îÄ shell/ # Script shell (.sh) opzionali
‚îú‚îÄ‚îÄ .env.example # Template per le variabili d‚Äôambiente
‚îú‚îÄ‚îÄ docker-compose.yml # Definizione dei container in locale
‚îî‚îÄ‚îÄ README.md # Questo file

bash
Copia
Modifica

## ‚öôÔ∏è Configurare le variabili d‚Äôambiente

1. Copia il template:
   ```powershell
   copy .env.example .env
Apri .env e personalizza i valori (porte, credenziali, flag ENABLE_*).

## üíæ Persistenza dei dati

Per mantenere i dati fra i riavvii dei container, Docker monta i volumi locali:

- `./data/postgres` ‚Üí contiene tutti i dati di Postgres  
- `./data/konga` ‚Üí (se abilitato) contiene il file SQLite di Konga  

> **Non modificare** manualmente i file in queste cartelle: gestisci il database solo tramite i comandi Docker o psql.

Il bootstrap delle migrazioni di Kong (`kong migrations bootstrap`) va eseguito **una sola volta**, perch√© la definizione delle tabelle rimane salvata in `./data/postgres`.

## ‚öôÔ∏è Servizi modulari con `--profile`

Puoi usare i **profiles** di Docker Compose abbinati ai flag `ENABLE_*` in `.env`.  
Esempi:

- **Avvia solo Redis e RabbitMQ**:  
  ```powershell
  docker-compose --profile redis --profile rabbitmq up -d
Avvia tutti i servizi (default):

docker-compose up -d
Assicurati che i nomi dei profili corrispondano ai flag ENABLE_* nel file .env.

‚ùó Problemi comuni
Se Kong o Konga si arrestano da soli, verifica:

Postgres √® attivo e healthy (docker ps ‚Üí porta 5432)

Le migrazioni Kong sono state eseguite una sola volta:

docker-compose exec kong kong migrations bootstrap
Le variabili d‚Äôambiente (KONG_DATABASE, DB_HOST, ecc.) sono configurate correttamente

üí° Suggerimenti rapidi
Per modificare rapidamente il file .env, puoi aprirlo in VS Code:


code .env
Usa gli script PowerShell in scripts/powershell/ per gestire l‚Äôinfrastruttura:

up.ps1

down.ps1

status.ps1

üöÄ Avvio dei servizi
Assicurati di avere Docker Desktop avviato.

Da PowerShell, esegui:

powershell
Copia
Modifica
docker-compose up -d
Per fermare:

powershell
Copia
Modifica
docker-compose down
üîå Abilitare / Disabilitare i servizi
In .env trovi i flag ENABLE_POSTGRES, ENABLE_REDIS, ENABLE_RABBITMQ, ENABLE_KONG, ENABLE_KONGA.
Impostali su true o false e riavvia con:

powershell
Copia
Modifica
docker-compose down
docker-compose up -d
üíª Ambiente di sviluppo
Sistema operativo: Windows

Editor consigliato: Visual Studio Code

Versionamento con GitHub Desktop (nessun setup CLI Git necessario)